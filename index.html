<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Orange Card v8.1 - è„³ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    :root {
      --bg: #0f1115;
      --card: #171a21;
      --text: #e7e7e7;
      --muted: #a8b0bf;
      --accent: #ff9800;
      --danger: #e91e63;
      --line: #2a2f3a;
    }
    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    /* ========== TOPBAR ========== */
    .topbar {
      background: #11141b;
      border-bottom: 1px solid var(--line);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .topbar-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0.75rem 1rem;
      display: flex;
      gap: 1rem;
      align-items: center;
      justify-content: space-between;
    }
    .brand {
      font-weight: 900;
      font-size: 1.1rem;
    }
    .nav {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .tab {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--muted);
      padding: 0.45rem 0.75rem;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
    }
    .tab:hover {
      background: rgba(255, 152, 0, 0.1);
    }
    .tab.active {
      border-color: transparent;
      background: var(--accent);
      color: #111;
      font-weight: 850;
    }

    /* ========== CONTAINER ========== */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem;
    }
    .view.hidden {
      display: none !important;
    }
    .title {
      font-size: 1.35rem;
      margin: 0.2rem 0 1rem;
      font-weight: 700;
    }
    h2 {
      font-size: 1.1rem;
      margin: 0 0 0.75rem;
      font-weight: 700;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 1rem;
      margin-bottom: 1rem;
    }

    /* ========== INFO / DETAILS ========== */
    .info-banner {
      background: rgba(229, 57, 53, 0.15);
      border: 2px solid #e53935;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .info-banner strong {
      color: #ff6b6b;
    }
    .science-details {
      background: rgba(255, 152, 0, 0.08);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 0;
      margin: 1rem 0;
    }
    .science-details summary {
      padding: 1rem;
      cursor: pointer;
      font-weight: 700;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .science-details summary:hover {
      background: rgba(255, 152, 0, 0.1);
    }
    .science-details[open] summary {
      border-bottom: 1px solid var(--line);
    }
    .science-details-content {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      font-size: 0.9rem;
      font-family: Monaco, "Courier New", monospace;
      overflow-x: auto;
    }
    .science-details-content pre {
      margin: 0;
      color: #90caf9;
      line-height: 1.5;
    }
    .brain-explanation {
      background: rgba(255, 152, 0, 0.05);
      border-left: 4px solid var(--accent);
      padding: 0.75rem;
      margin: 0.75rem 0;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .brain-explanation strong {
      color: var(--accent);
    }

    /* ========== FORM ========== */
    label {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      color: var(--muted);
      font-size: 0.95rem;
    }
    select,
    input[type="number"] {
      padding: 0.6rem 0.7rem;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: #0d0f14;
      color: var(--text);
      min-width: 5rem;
      cursor: pointer;
      font-size: 0.95rem;
    }
    button {
      padding: 0.6rem 0.9rem;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #111;
      cursor: pointer;
      font-weight: 850;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }
    button:hover {
      background: #ff8c00;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
    }
    button:active {
      transform: scale(0.95);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--line);
    }
    button.secondary:hover {
      background: rgba(255, 152, 0, 0.15);
      border-color: var(--accent);
    }
    button.danger {
      background: var(--danger);
      color: #fff;
    }
    button.danger:hover {
      background: #d81b60;
    }
    .row {
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    .muted {
      color: var(--muted);
      font-size: 0.9rem;
    }

    /* ========== STAGE ========== */
    .stage {
      margin-top: 1rem;
      position: relative;
      width: 100%;
      max-width: 720px;
      height: 360px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--line);
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: auto;
      margin-right: auto;
    }
    .orange-card {
      width: 400px;
      height: 250px;
      background: linear-gradient(135deg, #ff9800 0%, #ff8c00 50%, #ff9800 100%);
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow:
        0 0 60px rgba(255, 152, 0, 0.8),
        0 0 20px rgba(255, 100, 0, 0.6);
      z-index: 10;
    }
    .orange-card::before {
      content: "";
      position: absolute;
      width: 160px;
      height: 160px;
      background: #1e88e5;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 11;
    }
    .orange-card::after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      background: #000;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 12;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
    }

    /* ========== FULLSCREEN OVERLAY ========== */
    .fullscreen-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 99999;
      visibility: hidden;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .fullscreen-overlay.show {
      visibility: visible !important;
      opacity: 1 !important;
    }
    .fullscreen-overlay.hidden {
      visibility: hidden !important;
      opacity: 0 !important;
    }
    .fullscreen-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2rem;
      width: 100%;
      height: 100%;
    }
    .fullscreen-timer {
      font-size: 4rem;
      font-weight: 1000;
      color: var(--accent);
      text-shadow: 0 0 20px rgba(255, 152, 0, 0.8);
      font-family: "Courier New", monospace;
      letter-spacing: 0.1em;
      animation: pulse 1s ease-in-out;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .fullscreen-label {
      font-size: 1.5rem;
      color: var(--accent);
      text-align: center;
      animation: fadeInUp 0.6s ease-out;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .fullscreen-instruction {
      position: absolute;
      bottom: 2rem;
      color: var(--muted);
      font-size: 1rem;
      text-align: center;
      animation: blink 2s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 49%, 100% { opacity: 0.5; }
      50%, 99% { opacity: 1; }
    }
    .orange-card-fullscreen {
      width: 80vw;
      height: 60vh;
      max-width: 600px;
      max-height: 450px;
      background: linear-gradient(135deg, #ff9800 0%, #ff8c00 50%, #ff9800 100%);
      border-radius: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow:
        0 0 100px rgba(255, 152, 0, 1),
        0 0 40px rgba(255, 100, 0, 0.8);
      animation: cardEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes cardEnter {
      from {
        transform: scale(0.8);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    .orange-card-fullscreen::before {
      content: "";
      position: absolute;
      width: 200px;
      height: 200px;
      background: #1e88e5;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 11;
    }
    .orange-card-fullscreen::after {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      background: #000;
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 12;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.9);
    }

    /* ========== AFTER IMAGE OVERLAY ========== */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 99998;
      visibility: hidden;
      opacity: 0;
      transition: all 0.15s ease;
    }
    .overlay.show {
      visibility: visible !important;
      opacity: 1 !important;
    }
    .overlay.hidden {
      visibility: hidden !important;
      opacity: 0 !important;
      display: none !important;
    }
    .overlay-inner {
      text-align: center;
      max-width: 540px;
    }
    .big {
      font-size: 1.4rem;
      font-weight: 950;
      margin-bottom: 0.25rem;
    }
    .small {
      color: var(--muted);
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }
    .timer {
      font-size: 2.2rem;
      font-weight: 1000;
      margin: 0.5rem 0 1rem;
      color: var(--accent);
    }

    /* ========== SHARPNESS OVERLAY ========== */
    .sharpness-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      z-index: 99997;
      visibility: hidden;
      opacity: 0;
      transition: all 0.15s ease;
    }
    .sharpness-overlay.show {
      visibility: visible !important;
      opacity: 1 !important;
    }
    .sharpness-overlay.hidden {
      visibility: hidden !important;
      opacity: 0 !important;
      display: none !important;
    }
    .sharpness-inner {
      text-align: center;
      max-width: 540px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 2rem;
      z-index: 100000;
    }
    .sharpness-title {
      font-size: 1.3rem;
      font-weight: 900;
      margin-bottom: 1.5rem;
    }
    .sharpness-options {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      align-items: center;
    }
    .sharpness-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
      padding: 0.75rem 1.5rem;
      border: 2px solid var(--line);
      border-radius: 12px;
      transition: all 0.2s;
      width: 100%;
      max-width: 300px;
    }
    .sharpness-option:hover {
      border-color: var(--accent);
      background: rgba(255, 152, 0, 0.05);
    }
    .sharpness-option input[type="radio"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: var(--accent);
    }
    .sharpness-option.selected {
      border-color: var(--accent);
      background: rgba(255, 152, 0, 0.1);
    }
    .sharpness-buttons {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      width: 100%;
      flex-wrap: wrap;
    }

    /* ========== BRAIN SECTION ========== */
    .brain-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      align-items: center;
      margin: 1.5rem 0;
    }
    .brain-visual {
      display: flex;
      justify-content: center;
      grid-column: 1 / -1;
    }
    .brain-visual svg {
      max-width: 100%;
      height: auto;
    }
    .gauge-bar {
      background: var(--line);
      border-radius: 8px;
      overflow: hidden;
      height: 24px;
      position: relative;
      margin-bottom: 8px;
    }
    .gauge-fill {
      height: 100%;
      border-radius: 8px;
      transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 8px;
      font-size: 0.75rem;
      font-weight: 700;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .gauge-label {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 4px;
      font-weight: 500;
    }
    .quality-score {
      background: rgba(255, 152, 0, 0.1);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      grid-column: 1 / -1;
    }
    .score-val {
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, #ffb300, #ff9800, #ff6b00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .score-label {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .kpi {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 0.55rem 0.7rem;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(0,0,0,0.15);
    }
    .kpi-val {
      color: var(--text);
      font-weight: 950;
    }
    .score-badge {
      display: inline-block;
      padding: 0.25rem 0.6rem;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 700;
      margin-left: 0.5rem;
    }
    .score-badge.excellent {
      background: rgba(46, 125, 50, 0.3);
      color: #66bb6a;
    }
    .score-badge.good {
      background: rgba(255, 179, 0, 0.3);
      color: #ffc107;
    }
    .score-badge.improving {
      background: rgba(229, 57, 53, 0.3);
      color: #ef5350;
    }

    /* ========== TABLE ========== */
    .table-wrapper {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-top: 1rem;
      border: 1px solid var(--line);
      border-radius: 8px;
    }
    .pattern-table {
      width: 100%;
      min-width: 800px;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .pattern-table thead {
      background: rgba(255, 152, 0, 0.15);
      border-bottom: 2px solid var(--accent);
    }
    .pattern-table th {
      padding: 0.75rem;
      text-align: left;
      font-weight: 700;
      color: var(--accent);
      border: 1px solid var(--line);
    }
    .pattern-table td {
      padding: 0.75rem;
      border: 1px solid var(--line);
      border-bottom: 1px solid rgba(255, 152, 0, 0.2);
    }
    .pattern-table tbody tr:hover {
      background: rgba(255, 152, 0, 0.05);
    }
    .star-rating {
      color: var(--accent);
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.05em;
    }
    .pattern-name {
      font-weight: 600;
      color: var(--accent);
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 900px) {
      .brain-section {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      .topbar-inner {
        flex-direction: column;
        align-items: flex-start;
      }
      .nav {
        width: 100%;
      }
      .stage {
        width: 100%;
      }
      .orange-card {
        width: 300px;
        height: 200px;
      }
      .fullscreen-timer {
        font-size: 3rem;
      }
      .fullscreen-label {
        font-size: 1.2rem;
      }
      
      /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¹ãƒãƒ›æœ€é©åŒ– */
      .pattern-table {
        font-size: 0.7rem;
        min-width: 750px;
      }
      .pattern-table th,
      .pattern-table td {
        padding: 0.4rem;
      }
      .star-rating {
        font-size: 0.95rem;
        letter-spacing: 0.02em;
      }
    }

    .section-subtitle {
      font-size: 1rem;
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: var(--accent);
    }
    .explanation-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }
    .explanation-box {
      background: rgba(255, 152, 0, 0.08);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 0.75rem;
    }
    .explanation-box h4 {
      margin: 0 0 0.5rem;
      color: var(--accent);
      font-size: 0.95rem;
    }
    .explanation-box p {
      margin: 0;
      font-size: 0.85rem;
      line-height: 1.5;
      color: var(--muted);
    }
    .explanation-box p + p {
      margin-top: 0.5rem;
    }
    @media (max-width: 900px) {
      .explanation-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ========== TOPBAR ========== -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ã‚²ãƒ¼ãƒˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</div>
      <nav class="nav">
        <button class="tab active" data-tab="training">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</button>
        <button class="tab" data-tab="dashboard">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
        <button class="tab" data-tab="analysis">åˆ†æ</button>
        <button class="tab" data-tab="settings">è¨­å®š</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- ========== INFO BANNER ========== -->
    <div class="info-banner">
      <strong>âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</strong><br>
      ã“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¯è„³ã®è¦–è¦šæ©Ÿèƒ½ã‚’åˆºæ¿€ã™ã‚‹ãŸã‚ã€fMRIãªã©ã®è„³ç”»åƒç ”ç©¶ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚<br>
      ãŸã ã—ã€<strong>è„³é ˜åŸŸã®%å€¤ã¯æ¨å®šå€¤ã§ã‚ã‚Šã€å®Ÿæ¸¬ã®è„³ç”»åƒã§ã¯ã‚ã‚Šã¾ã›ã‚“</strong>ã€‚<br>
      åŒ»ç™‚çš„ãªè¨ºæ–­ãƒ»æ²»ç™‚ã«ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„ã€‚ ä¸å¿«æ„Ÿã‚„é•å’Œæ„ŸãŒã‚ã‚‹å ´åˆã¯ã€ç›´ã¡ã«ä¸­æ­¢ã—ã¦ãã ã•ã„ã€‚æœ¬ã‚¢ãƒ—ãƒªã¯HOKRï¼ˆæ°´å¹³è¦–é‹å‹•æ€§çœ¼æŒ¯ï¼‰ãªã©ã®ç ”ç©¶ã‚’ã‚‚ã¨ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚<br>
      è„³é ˜åŸŸã®æ´»æ€§åŒ–ã¯ã€fMRIãªã©ã§è¨ˆæ¸¬ã•ã‚Œã‚‹è¡€æµå¤‰åŒ–ï¼ˆæ©Ÿèƒ½çš„å……è¡€ï¼‰ã‚’æŒ‡æ¨™ã¨ã—ã¦ãŠã‚Šã€ç¥çµŒæ´»å‹•ãã®ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
    </div>

    <!-- ========== TRAINING VIEW ========== -->
    <section id="training" class="view">
      <h1 class="title">ğŸŸ  ã‚ªãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
      <div class="card">
        <div class="row">
          <label>
            å‡è¦–æ™‚é–“
            <select id="stareSec">
              <option value="3">3ç§’</option>
              <option value="5">5ç§’</option>
              <option value="10" selected>10ç§’</option>
              <option value="15">15ç§’</option>
              <option value="20">20ç§’</option>
              <option value="30">30ç§’</option>
              <option value="60">60ç§’</option>
            </select>
          </label>
          <button id="startBtn" onclick="handleStartClick()">ğŸš€ é–‹å§‹</button>
        </div>
      </div>

      <!-- ========== SCIENCE DETAILS ========== -->
      <details class="science-details">
        <summary>ğŸ”¬ ã‚¹ã‚³ã‚¢ã¯ã©ã†è¨ˆç®—ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ</summary>
        <div class="science-details-content">
          <pre>ã€å“è³ªã‚¹ã‚³ã‚¢è¨ˆç®—å¼ã€‘ï¼ˆv8.0æ”¹å–„ç‰ˆï¼‰
è¦–è¦šè² è· = min(100, æ®‹åƒæ™‚é–“ç§’ Ã— 10)
  â””â”€ æ®‹åƒãŒé•·ã„ã»ã©è¦–è¦šé‡ã®æ´»å‹•åº¦ãŒé«˜ã„
èªçŸ¥è² è· = min(100, æ³¨è¦–æ™‚é–“ç§’ Ã— 3)
  â””â”€ æ³¨è¦–ãŒé•·ã„ã»ã©å‰é ­è‘‰ã®æ³¨æ„åˆ¶å¾¡ãŒé«˜ã„
æ™‚é–“çµ±åˆ = min(100, log(æ³¨è¦–Ã—æ®‹åƒ+1) Ã— 15)
  â””â”€ æ³¨è¦–ã¨æ®‹åƒã®æ™‚é–“çš„çµ±åˆãŒå´é ­è‘‰ã‚’æ´»æ€§åŒ–

å“è³ªã‚¹ã‚³ã‚¢ = (è¦–è¦šè² è· + èªçŸ¥è² è· + æ™‚é–“çµ±åˆ) / 3

ã€ç¥çµŒç§‘å­¦çš„æ ¹æ‹ ã€‘
âœ“ è¦–è¦šåˆºæ¿€â†’è¦–è¦šé‡æ´»æ€§åŒ–:ä¸»ã«è¡€æµãªã©ã®å¤‰åŒ–ï¼ˆæ©Ÿèƒ½çš„å……è¡€ï¼‰ã‚’æŒ‡æ¨™ã«ã—ã¦ç¥çµŒæ´»å‹•ã‚’æ¨æ¸¬ã—ã¦ã„ã‚‹
âœ“ çœ¼çƒé‹å‹•å­¦ç¿’â†’å°è„³å¯å¡‘åŒ–: å°è„³å¯å¡‘æ€§ãŒé–¢ä¸ã™ã‚‹å­¦ç¿’ï¼ˆHOKRï¼‰ã¨ã€è¡€ç®¡é‹å‹•ã®å¢—å¹…ãŒä¸¦è¡Œã—ã¦è¦³å¯Ÿã•ã‚ŒãŸ
âœ“ è„³è¡€ç®¡é‹å‹•ã®å¢—å¹…: ä½å‘¨æ³¢åˆºæ¿€ã§å®Ÿè¨¼ã€‚æ±åŒ—å¤§ã®è³‡æ–™ã§ã¯ã€0.25 Hzï¼ˆ4ç§’ã«1å›ï¼‰ã®æ°´å¹³æ–¹å‘ã«æŒ¯å‹•ã™ã‚‹ç¸¦ç¸æ¨¡æ§˜ã‚’ç¹°ã‚Šè¿”ã—æç¤ºã™ã‚‹ã¨ã€è¦–è¦šåˆºæ¿€ã®å‘¨æ³¢æ•°ã«ä¸€è‡´ã—ãŸè¡€ç®¡é‹å‹•ãŒè¦³å¯Ÿã•ã‚Œã€ç¹°ã‚Šè¿”ã—ã§ãã®æŒ¯å¹…ãŒå¾ã€…ã«å¢—å¹…ã€‚ã¾ãŸã€ãã®åŒèª¿ã—ãŸè¡€ç®¡é‹å‹•ãŒä¸€æ¬¡è¦–è¦šé‡ã ã‘ã§ãªãã€å¤§è„³çš®è³ªã‚„å°è„³ã®åºƒã„é ˜åŸŸã«ã‚‚èª˜å°ã•ã‚ŒãŸ

ã€æ³¨æ„ã€‘
âš  è„³é ˜åŸŸã®%å€¤ã¯æ¨å®šå€¤ã§ã™
âš  å®Ÿæ¸¬ã®è„³ç”»åƒã§ã¯ã‚ã‚Šã¾ã›ã‚“
âš  ç›¸å¯¾çš„ãªæ´»å‹•åº¦ã®æŒ‡æ¨™ã§ã™</pre>
        </div>
      </details>

      <div class="brain-explanation">
        <strong>ğŸ’¡ è„³é ˜åŸŸã«ã¤ã„ã¦</strong><br>
        <strong>å¾Œé ­è‘‰</strong>: è‰²ãƒ»å½¢ãƒ»å‹•ããªã©è¦–è¦šæƒ…å ±ã®åŸºæœ¬å‡¦ç†<br>
        <strong>å‰é ­è‘‰</strong>: æ³¨æ„åŠ›ãƒ»é›†ä¸­åŠ›ã®ç¶­æŒã¨åˆ¶å¾¡<br>
        <strong>é ­é ‚è‘‰</strong>: ç©ºé–“èªè­˜ãƒ»å¥¥è¡ŒãçŸ¥è¦š<br>
        <strong>å´é ­è‘‰</strong>: è¨˜æ†¶å½¢æˆãƒ»è¦–è¦šæƒ…å ±ã®çµ±åˆä¿å­˜<br>
        <strong>å°è„³</strong>: çœ¼çƒé‹å‹•ã®å­¦ç¿’ã¨å”èª¿
      </div>

      <div class="stage" id="stage" style="display:none">
        <div class="orange-card" id="orangeCard"></div>
      </div>

      <!-- ========== FULLSCREEN OVERLAY ========== -->
      <div id="fullscreenOverlay" class="fullscreen-overlay">
        <div class="fullscreen-inner">
          <div class="orange-card-fullscreen" id="orangeCardFullscreen"></div>
          <div class="fullscreen-timer" id="fullscreenTimer">10</div>
          <div class="fullscreen-label">ğŸ¯ ã‚«ãƒ¼ãƒ‰ã®ä¸­å¿ƒã‚’å‡è¦–ã—ã¦ãã ã•ã„</div>
          <div class="fullscreen-instruction">ğŸ‘ é»’ã„ç‚¹ã‚’ã—ã£ã‹ã‚Šè¦‹ã¤ã‚ã¦ãã ã•ã„</div>
        </div>
      </div>

      <div id="afterImageOverlay" class="overlay">
        <div class="overlay-inner">
          <div class="big">âœ¨ æ®‹åƒã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
          <div class="small">ç›®ã‚’é–‰ã˜ã‚‹ã‹ã€å£ã‚’è¦‹ã¤ã‚ã¦ãã ã•ã„</div>
          <div class="timer"><span id="afterSec">0.0</span>ç§’</div>
          <div class="small">æ®‹åƒãŒæ¶ˆãˆãŸã‚‰ã‚¯ãƒªãƒƒã‚¯</div>
        </div>
      </div>

      <div id="sharpnessOverlay" class="sharpness-overlay">
        <div class="sharpness-inner">
          <div class="sharpness-title">æ®‹åƒã®é®®æ˜ã•ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
          <div class="sharpness-options">
            <label class="sharpness-option">
              <input type="radio" name="sharpness" value="3" checked>
              <span>3 - éå¸¸ã«é®®æ˜ï¼ˆè‰²ãƒ»å½¢ãŒã¯ã£ãã‚Šè¦‹ãˆãŸï¼‰</span>
            </label>
            <label class="sharpness-option">
              <input type="radio" name="sharpness" value="2">
              <span>2 - ã¼ã‚“ã‚„ã‚Šè¦‹ãˆãŸï¼ˆè‰²ã‚„å½¢ãŒã†ã£ã™ã‚‰ï¼‰</span>
            </label>
            <label class="sharpness-option">
              <input type="radio" name="sharpness" value="1">
              <span>1 - ã»ã¼è¦‹ãˆãªã‹ã£ãŸ</span>
            </label>
          </div>
          <div class="sharpness-buttons">
            <button id="confirmBtn" onclick="handleConfirmClick()">âœ… ç¢ºå®š</button>
            <button id="retryBtn" class="secondary" onclick="handleRetryClick()">ğŸ” ã‚‚ã†ä¸€åº¦</button>
          </div>
        </div>
      </div>

      <div class="card" id="resultCard" style="display:none">
        <h3 style="margin: 0 0 0.5rem 0">ğŸ“Š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµæœ</h3>
        <div id="resultText" style="color: var(--muted); font-size: 0.9rem; line-height: 1.6;"></div>
      </div>

      <div class="card">
        <h2>ğŸ§  è„³æ´»å‹•ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«</h2>
        <div class="brain-explanation">
          <strong>è„³é ˜åŸŸæ´»æ€§åŒ–æŒ‡æ¨™ï¼ˆç¾çŠ¶ã§åˆ†ã‹ã£ã¦ã„ã‚‹ç¯„å›²ï¼‰</strong><br>
          <ul style="margin:0.5rem 0 0; padding-left:1.2rem; line-height:1.7;">
            <li><strong>å¾Œé ­è‘‰</strong>ï¼šæ³¨è¦–æ™‚é–“ã€‚ã‚ªãƒ¬ãƒ³ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‚ã‚‹ â†’ V1è¦–è¦šé‡ã§è¦–è¦šå‡¦ç†ã€‚</li>
            <li><strong>å´é ­è‘‰</strong>ï¼šæ®‹åƒæ™‚é–“ Ã— ã‚·ãƒ£ãƒ¼ãƒ—ãƒã‚¹ã€‚æ®‹åƒã‚’èªè­˜ã™ã‚‹ â†’ ITçš®è³ªã§è¦–è¦šã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ³ã‚°ã€‚</li>
            <li><strong>å‰é ­è‘‰</strong>ï¼šæ³¨è¦–æ™‚é–“ã€‚ã‚«ãƒ¼ãƒ‰ã‚’ãšã£ã¨è¦‹ã¤ã‚ç¶šã‘ã‚‹ â†’ æ³¨è¦–æ³¨æ„åˆ¶å¾¡ã€‚</li>
            <li><strong>é ­é ‚è‘‰</strong>ï¼šæ³¨è¦–ï¼‹æ®‹åƒã®è¤‡åˆã€‚çœ¼çƒé‹å‹•ã¨ç©ºé–“èªè­˜ã€‚</li>
          </ul>
          <div style="margin-top:0.5rem; color:var(--muted); font-size:0.85rem;">
            â€»ã“ã®è¡¨ç¤ºã¯fMRIç­‰ã®å®Ÿæ¸¬ã§ã¯ãªãã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹ï¼ˆæ³¨è¦–ãƒ»æ®‹åƒãƒ»é®®æ˜ã•ï¼‰ã‹ã‚‰ã®æ¨å®šãƒ¢ãƒ‡ãƒ«ã§ã™ã€‚
          </div>
        </div>
        <div style="margin-top:0.5rem; color:var(--muted); font-size:0.85rem;">
          <strong>ğŸ’¡ ä½¿ã„æ–¹ï¼š</strong>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã‚ãªãŸã®è„³æ´»å‹•ã®æ¨å®šåº¦ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
          ã“ã‚Œã¯ã‚¢ãƒ—ãƒªãŒè¨ˆç®—ã—ãŸç›¸å¯¾çš„ãªæ´»å‹•æŒ‡æ¨™ã§ã‚ã‚Šã€å®Ÿæ¸¬ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
        </div>
      </div>

      <div id="sessionHint" class="muted" style="margin-bottom: 1rem;">
        <strong>ğŸ¯ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</strong>
      </div>

      <div class="brain-visual">
        <svg id="brainSvg" viewBox="0 0 800 420" role="img" aria-label="è„³ã®æ´»å‹•ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«" style="background: transparent;">
          <defs>
            <filter id="glow">
              <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>

          <!-- å‰é ­è‘‰ -->
          <path id="lobeFrontal" class="lobe" d="M150,120 Q165,105 225,110 Q255,120 255,210 Q248,225 210,232 Q165,225 150,195 Z" stroke="#fff" stroke-width="2" fill="#2e7d32" opacity="0.8"/>
          <text id="pctFrontalText" x="195" y="180" fill="#fff" font-size="18" font-weight="700" text-anchor="middle" pointer-events="none">-</text>
          <text x="195" y="260" fill="#e7e7e7" font-size="12" text-anchor="middle" pointer-events="none">å‰é ­è‘‰</text>
          <text x="195" y="275" fill="#a8b0bf" font-size="10" text-anchor="middle" pointer-events="none">æ³¨æ„åˆ¶å¾¡</text>

          <!-- é ­é ‚è‘‰ -->
          <path id="lobeParietal" class="lobe" d="M255,110 Q310,95 420,105 Q450,120 435,210 Q405,225 315,220 Q260,215 255,150 Z" stroke="#fff" stroke-width="2" fill="#ffb300" opacity="0.8"/>
          <text id="pctParietalText" x="350" y="160" fill="#fff" font-size="18" font-weight="700" text-anchor="middle" pointer-events="none">-</text>
          <text x="350" y="85" fill="#e7e7e7" font-size="12" font-weight="700" text-anchor="middle" pointer-events="none">é ­é ‚è‘‰</text>
          <text x="350" y="100" fill="#e7e7e7" font-size="10" text-anchor="middle" pointer-events="none">ç©ºé–“èªè­˜</text>

          <!-- å´é ­è‘‰ -->
          <path id="lobeTemporal" class="lobe" d="M225,210 Q255,235 330,250 Q360,260 360,320 Q330,345 270,335 Q225,320 225,270 Z" stroke="#fff" stroke-width="2" fill="#e53935" opacity="0.8"/>
          <text id="pctTemporalText" x="295" y="285" fill="#fff" font-size="18" font-weight="700" text-anchor="middle" pointer-events="none">-</text>
          <text x="295" y="375" fill="#e7e7e7" font-size="12" text-anchor="middle" pointer-events="none">å´é ­è‘‰</text>
          <text x="295" y="390" fill="#a8b0bf" font-size="10" text-anchor="middle" pointer-events="none">è¦–è¦šè¨˜æ†¶</text>

          <!-- å¾Œé ­è‘‰ -->
          <path id="lobeOccipital" class="lobe" d="M435,105 Q500,120 545,150 Q570,190 545,280 Q500,315 435,305 Q435,200 435,150 Z" stroke="#fff" stroke-width="2" fill="#0078d4" opacity="0.8"/>
          <text id="pctOccipitalText" x="500" y="215" fill="#fff" font-size="18" font-weight="700" text-anchor="middle" pointer-events="none">-</text>
          <text x="500" y="260" fill="#e7e7e7" font-size="12" text-anchor="middle" pointer-events="none">å¾Œé ­è‘‰</text>
          <text x="500" y="275" fill="#a8b0bf" font-size="10" text-anchor="middle" pointer-events="none">è¦–è¦šå‡¦ç†</text>
        </svg>
      </div>

      <div style="margin-top: 1.5rem;">
        <div class="gauge-label">ğŸ“Š è¦–è¦šè² è·</div>
        <div class="gauge-bar">
          <div class="gauge-fill" id="gaugeVisual" style="width: 0%; background: linear-gradient(90deg, #0078d4, #2e7d32, #ffb300, #e53935);">
            <span id="gaugeVisualText">-</span>
          </div>
        </div>

        <div class="gauge-label">ğŸ§  èªçŸ¥è² è·</div>
        <div class="gauge-bar">
          <div class="gauge-fill" id="gaugeCog" style="width: 0%; background: linear-gradient(90deg, #2e7d32, #ffb300, #ff8c00);">
            <span id="gaugeCogText">-</span>
          </div>
        </div>

        <div class="gauge-label">â±ï¸ æ™‚é–“çµ±åˆ</div>
        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text);">
          <span id="temporalVal">-</span>
        </div>
      </div>

      <div class="quality-score">
        <div class="score-val" id="qualityScore">-</div>
        <div class="score-label" id="qualityLabel">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„</div>
      </div>
    </section>

    <!-- ========== DASHBOARD VIEW ========== -->
    <section id="dashboard" class="view hidden">
      <h1 class="title">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div class="card">
        <div class="row">
          <div class="kpi">
            <span>ä»Šæ—¥ï¼š</span>
            <span class="kpi-val" id="todayCount">0</span>
          </div>
          <div class="kpi">
            <span>åˆè¨ˆï¼š</span>
            <span class="kpi-val" id="totalCount">0</span>
          </div>
          <div class="kpi">
            <span>å¹³å‡æ®‹åƒï¼š</span>
            <span class="kpi-val" id="avgAfterImage">-</span>
            <span class="score-badge" id="avgBadge"></span>
          </div>
          <div class="kpi">
            <span>å®‰å®šæ€§ï¼ˆSDï¼‰ï¼š</span>
            <span class="kpi-val" id="stability">-</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ“ˆ æ®‹åƒæ™‚é–“ã®æ¨ç§»</h2>
        <canvas id="afterImageChart" style="max-height: 300px; margin-bottom: 1rem;"></canvas>
      </div>

      <div class="card">
        <h2>ğŸ¯ é®®æ˜åº¦ã®åˆ†å¸ƒ</h2>
        <canvas id="sharpnessChart" style="max-height: 250px; margin-bottom: 1rem;"></canvas>
      </div>

      <div class="card">
        <h2>ğŸ• æœ€è¿‘10å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h2>
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
            <thead>
              <tr style="border-bottom: 1px solid var(--line);">
                <th style="padding: 0.5rem; text-align: left;">æ™‚åˆ»</th>
                <th style="padding: 0.5rem; text-align: left;">å‡è¦–</th>
                <th style="padding: 0.5rem; text-align: left;">æ®‹åƒ</th>
                <th style="padding: 0.5rem; text-align: left;">é®®æ˜åº¦</th>
              </tr>
            </thead>
            <tbody id="recentTable"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ========== ANALYSIS VIEW ========== -->
    <section id="analysis" class="view hidden">
      <h1 class="title">ğŸ§ª åˆ†æ</h1>

      <!-- ========== è„³ã®çŠ¶æ…‹è©•ä¾¡è¡¨ ========== -->
      <div class="card">
        <h2>ğŸ§  è„³ã®çŠ¶æ…‹è©•ä¾¡è¡¨</h2>
        <p class="description">
          å‡è¦–æ™‚é–“ã¨æ®‹åƒæ™‚é–“ã®çµ„ã¿åˆã‚ã›ã¦ã€4ã¤ã®è„³é ˜åŸŸï¼ˆå‰é ­è‘‰ãƒ»å´é ­è‘‰ãƒ»å¾Œé ­è‘‰ãƒ»é ­é ‚è‘‰ï¼‰ã®æ´»å‹•ãƒ¬ãƒ™ãƒ«ã‚’è©•ä¾¡ã—ãŸè¡¨ã§ã™ã€‚
        </p>
        <div class="table-wrapper">
          <table class="pattern-table">
            <thead>
              <tr>
                <th>ãƒ‘ã‚¿ãƒ¼ãƒ³</th>
                <th>å‡è¦–ç§’</th>
                <th>æ®‹åƒç§’</th>
                <th>åŠ¹ç‡æ¯”</th>
                <th>å‰é ­è‘‰ï¼ˆç¶­æŒï¼‰</th>
                <th>å´é ­è‘‰ï¼ˆç”Ÿæˆï¼‰</th>
                <th>å¾Œé ­è‘‰ï¼ˆå—å®¹ï¼‰</th>
                <th>é ­é ‚è‘‰ï¼ˆç©ºé–“ï¼‰</th>
                <th>è„³ã®çŠ¶æ…‹è§£èª¬</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="pattern-name">A</td>
                <td>5</td>
                <td>30</td>
                <td>6.0å€</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td><span class="description">è¶…é«˜åŠ¹ç‡ã‚¤ãƒ¡ãƒ¼ã‚¸å‹ï¼šæœ€å°ã®åˆºæ¿€ã§è„³ãŒçŸ¥è¦šã‚’è‡ªçµ¦è‡ªè¶³ã—ã¦ã„ã‚‹ã€‚</span></td>
              </tr>
              <tr>
                <td class="pattern-name">B</td>
                <td>10</td>
                <td>30</td>
                <td>3.0å€</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td><span class="description">é«˜åŠ¹ç‡ã‚¤ãƒ¡ãƒ¼ã‚¸å‹ï¼šå´é ­è‘‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ç”ŸæˆåŠ›ãŒéå¸¸ã«é«˜ã„çŠ¶æ…‹ã€‚</span></td>
              </tr>
              <tr>
                <td class="pattern-name">C</td>
                <td>15</td>
                <td>30</td>
                <td>2.0å€</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…</td>
                <td><span class="description">ãƒãƒ©ãƒ³ã‚¹å‹ï¼šè„³å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ç‰©ç†çš„é€£å‹•ãŒç¨‹ã‚ˆãé€£å‹•ã€‚</span></td>
              </tr>
              <tr>
                <td class="pattern-name">D</td>
                <td>20</td>
                <td>30</td>
                <td>1.5å€</td>
                <td class="star-rating">â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…</td>
                <td><span class="description">æ¨™æº–å‹ï¼šé©åº¦ãªåˆºæ¿€å…¥åŠ›ã‚’è„³ãŒè£œæ­£ã—ã¦ç¶­æŒã—ã¦ã„ã‚‹ã€‚</span></td>
              </tr>
              <tr>
                <td class="pattern-name">E</td>
                <td>30</td>
                <td>30</td>
                <td>1.0å€</td>
                <td class="star-rating">â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…</td>
                <td><span class="description">ç”Ÿç†çš„é©å¿œå‹ï¼šç¶²è†œã®ç–²ã‚Œï¼ˆç‰©ç†ç¾è±¡ï¼‰ã¸ã®ä¾å­˜åº¦ãŒé«˜ã„ã€‚</span></td>
              </tr>
              <tr>
                <td class="pattern-name">F</td>
                <td>30</td>
                <td>60</td>
                <td>2.0å€</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td class="star-rating">â˜…â˜…â˜…â˜…â˜…</td>
                <td><span class="description">é«˜è² è·æŒä¹…å‹ï¼šå¼·ã„åˆºæ¿€å…¥åŠ›ã‚’é•·æ™‚é–“ç¶­æŒã™ã‚‹å…¨è„³çš„ãªæŒä¹…åŠ›ã€‚</span></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- ========== è„³é ˜åŸåˆ¥è©³ç´°è©•ä¾¡ ========== -->
      <div class="card">
        <h2>è„³é ˜åŸŸåˆ¥ã®è©³ç´°è©•ä¾¡</h2>
        <div class="explanation-grid">
          <div class="explanation-box" style="border-left: 3px solid #ff9800;">
            <h4>å‰é ­è‘‰ï¼ˆå®Ÿè¡Œæ©Ÿèƒ½ãƒ»æ³¨æ„ç¶­æŒï¼‰</h4>
            <p><strong>5ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…â˜…</span></p>
            <p>ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ„è­˜ã«å¼·ãä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€æœ€å¤§ã®è² è·ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚</p>
            <p><strong>10ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…</span></p>
            <p>å‰é ­è‘‰ã®é©åº¦ãªè² è·ã€‚ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ…‹ã§ã™ã€‚</p>
            <p><strong>30ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…</span></p>
            <p>å¤–éƒ¨å…¥åŠ›ãŒé•·ã„ãŸã‚è² è·ãŒä½ãã€è„³ãŒå—å‹•çš„ã«æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚</p>
          </div>
          <div class="explanation-box" style="border-left: 3px solid #ff9800;">
            <h4>å´é ­è‘‰ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ç”Ÿæˆãƒ»è‰²å‡¦ç†ï¼‰</h4>
            <p><strong>5ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…â˜…</span></p>
            <p>çŸ­ã„åˆºæ¿€ã‹ã‚‰æœ€å¤§é™ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹èƒ½åŠ›ã‚’ç™ºæ®ã€‚</p>
            <p><strong>10ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…â˜…</span></p>
            <p>æœ€é«˜ãƒ¬ãƒ™ãƒ«ã®ã‚¤ãƒ¡ãƒ¼ã‚¸åŠ›ã€‚ã‚ãªãŸã¯ã“ã®ãƒ¬ãƒ™ãƒ«ã«ã‚ã‚Šã¾ã™ï¼</p>
            <p><strong>30ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…</span></p>
            <p>é•·ã„åˆºæ¿€ã«é ¼ã‚‹ãŸã‚ã€ç”ŸæˆåŠ›ãŒç›®ç«‹ãŸãªã„çŠ¶æ…‹ã€‚</p>
          </div>
          <div class="explanation-box" style="border-left: 3px solid #ff9800;">
            <h4>å¾Œé ­è‘‰ï¼ˆè¦–è¦šå…¥åŠ›ãƒ»ç¶²è†œé©å¿œï¼‰</h4>
            <p><strong>5ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…</span></p>
            <p>å¤–éƒ¨åˆºæ¿€ã«ä¾å­˜ã—ãªã„ï¼ˆæœ€å°è² è·ï¼‰ï¼ è„³ã®è‡ªç«‹åº¦ãŒæœ€é«˜</p>
            <p><strong>10ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…</span></p>
            <p>ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ…‹ã€‚ç‰©ç†çš„ä¾å­˜ãŒå°‘ãªã„ã§ã™ã€‚</p>
            <p><strong>30ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…</span></p>
            <p>åŸºæº–ï¼šç¶²è†œã®ç‰©ç†çš„ç–²ã‚Œã«æœ€ã‚‚ä¾å­˜ã™ã‚‹çŠ¶æ…‹ã€‚</p>
          </div>
          <div class="explanation-box" style="border-left: 3px solid #ff9800;">
            <h4>é ­é ‚è‘‰ï¼ˆç©ºé–“æ³¨æ„ãƒ»çµ±åˆï¼‰</h4>
            <p><strong>5ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…â˜…</span></p>
            <p>ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åŒã˜ä½ç½®ã«å®‰å®šã•ã›ã‚‹åŠ›ãŒæœ€å¤§å¿…è¦ã€‚</p>
            <p><strong>10ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…â˜…</span></p>
            <p>ã‚ãªãŸã®ç¾åœ¨ã®çŠ¶æ…‹ã€‚ç©ºé–“çš„å®‰å®šæ€§ãŒè‰¯å¥½ã€‚</p>
            <p><strong>30ç§’å‡è¦– â†’ 30ç§’æ®‹åƒï¼š</strong> <span class="star-rating">â˜…â˜…â˜…</span></p>
            <p>å¤–éƒ¨è¦–è¦šå…¥åŠ›ã§å›ºå®šã•ã‚Œã‚„ã™ã„çŠ¶æ…‹ã€‚</p>
          </div>
        </div>
      </div>

      <!-- ========== è©•ä¾¡ã®èª­ã¿æ–¹ ========== -->
      <div class="card">
        <h2>â˜…è©•ä¾¡ã®èª­ã¿æ–¹</h2>
        <p class="description">
          å„è„³é ˜åŸŸã®â˜…ã®æ•°ã¯ã€ãã®é ˜åŸŸãŒãã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€Œã©ã‚Œã ã‘ä¸»å½¹ã¨ã—ã¦ã€ã¾ãŸã¯åŠ¹ç‡çš„ã«æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹ã€ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚
        </p>

        <div class="section-subtitle" style="border-left: 4px solid var(--accent); padding-left: 0.75rem;">å¾Œé ­è‘‰ï¼ˆå—å®¹ãƒ»å…¥åŠ›ä¾å­˜ï¼‰</div>
        <div class="brain-explanation">
          <p>å‡è¦–æ™‚é–“ãŒé•·ã„ã»ã©ã€ç¶²è†œã®ç‰©ç†çš„ãªç–²ã‚Œï¼ˆé©å¿œï¼‰ã«é ¼ã‚‹ãŸã‚ã€æ˜ŸãŒå¢—ãˆã¾ã™ã€‚</p>
          <p>å‡è¦–æ™‚é–“ãŒçŸ­ã„ã»ã©ã€å¤–éƒ¨åˆºæ¿€ã«é ¼ã£ã¦ã„ãªã„ãŸã‚ã€æ˜ŸãŒæ¸›ã‚Šã¾ã™ã€‚</p>
          <p><strong>æ„å‘³ï¼š</strong> ã“ã®å€¤ãŒä½ã„ã»ã©ã€è„³ã®è‡ªç«‹åº¦ãŒé«˜ã„ï¼ˆå¤–éƒ¨åˆºæ¿€ã«ä¾å­˜ã—ã¦ã„ãªã„ï¼‰ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚</p>
        </div>

        <div class="section-subtitle" style="border-left: 4px solid var(--accent); padding-left: 0.75rem;">å´é ­è‘‰ï¼ˆçŸ¥è¦šç”Ÿæˆãƒ»é®®æ˜åº¦ï¼‰</div>
        <div class="brain-explanation">
          <p>ã€ŒçŸ­ã„å‡è¦–ã§é•·ããƒ»é®®æ˜ã«è¦‹ãˆã‚‹ã€ã»ã©ã€æ˜ŸãŒå¢—ãˆã¾ã™ã€‚</p>
          <p>å´é ­è‘‰ï¼ˆç´¡éŒ˜çŠ¶å›ï¼‰ãŒã€å¤–éƒ¨åˆºæ¿€ãŒãªã„çŠ¶æ…‹ã§ã©ã‚Œã ã‘è‰²ã‚„å½¢ã‚’å†ç¾ã§ãã¦ã„ã‚‹ã‹ã‚’ç¤ºã—ã¾ã™ã€‚</p>
          <p><strong>æ„å‘³ï¼š</strong> ã“ã®å€¤ãŒé«˜ã„ã»ã©ã€ã‚¤ãƒ¡ãƒ¼ã‚¸å‡¦ç†èƒ½åŠ›ãŒå„ªç§€ã§ã™ã€‚</p>
        </div>

        <div class="section-subtitle" style="border-left: 4px solid var(--accent); padding-left: 0.75rem;">å‰é ­è‘‰ï¼ˆæ³¨æ„åˆ¶å¾¡ãƒ»ç¶­æŒï¼‰</div>
        <div class="brain-explanation">
          <p>æ®‹åƒã®çµ¶å¯¾çš„ãªæŒç¶šæ™‚é–“ãŒé•·ã„ã»ã©ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ„è­˜ã«ç•™ã‚ã‚‹ãŸã‚ã«å¤šãã®æ˜Ÿã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚</p>
          <p>30ç§’ä»¥ä¸Šã®ç¶­æŒã«ã¯ã€å‰é ­è‘‰ã¨é ­é ‚è‘‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã‚‹å¼·ã„ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ä¿¡å·ãŒå¿…è¦ã§ã™ã€‚</p>
          <p><strong>æ„å‘³ï¼š</strong> ã“ã®å€¤ãŒé«˜ã„ã»ã©ã€é›†ä¸­åŠ›ã¨æ„è­˜ã®ç¶­æŒåŠ›ãŒå„ªã‚Œã¦ã„ã¾ã™ã€‚</p>
        </div>

        <div class="section-subtitle" style="border-left: 4px solid var(--accent); padding-left: 0.75rem;">é ­é ‚è‘‰ï¼ˆç©ºé–“æ³¨æ„ãƒ»çµ±åˆï¼‰</div>
        <div class="brain-explanation">
          <p>æ®‹åƒã‚’ã€ŒåŒã˜å ´æ‰€ã€ã«å®‰å®šã—ã¦å›ºå®šã™ã‚‹èƒ½åŠ›ã«é–¢ã‚ã‚Šã¾ã™ã€‚</p>
          <p>é•·æ™‚é–“ã®ç¶­æŒã‚„ã€éå¸¸ã«çŸ­ã„åˆºæ¿€ã‹ã‚‰ã®ç”Ÿæˆæ™‚ã«ã€ç©ºé–“æƒ…å ±ã‚’è£œå®Œã™ã‚‹ãŸã‚ã«åƒãã¾ã™ã€‚</p>
          <p><strong>æ„å‘³ï¼š</strong> ã“ã®å€¤ãŒé«˜ã„ã»ã©ã€ç©ºé–“çš„ãªå®‰å®šæ€§ã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã®å›ºå®šåŠ›ãŒå¼·ã„ã§ã™ã€‚</p>
        </div>
      </div>

      <!-- ========== å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è§£èª¬ ========== -->
      <div class="card">
        <h2>ğŸ“Š å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è§£èª¬</h2>
        <p class="description">
          2025å¹´ã®æœ€æ–°ã®ç¥çµŒç§‘å­¦ç ”ç©¶ã‚’ã‚‚ã¨ã«ã€è„³æ´»å‹•ã®æ¨å®šãƒ¢ãƒ‡ãƒ«ã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚
        </p>

        <div class="section-subtitle">ğŸ”¬ è„³é ˜åŸŸã”ã¨ã®å½¹å‰²</div>
        <div class="brain-explanation">
          <strong>å‰é ­è‘‰ï¼ˆç¶­æŒï¼‰ï¼š</strong>è¦–è¦šæƒ…å ±ã®ç¶­æŒã¨æ³¨æ„ã®æŒç¶šåŠ›<br>
          <strong>å´é ­è‘‰ï¼ˆç”Ÿæˆï¼‰ï¼š</strong>æ®‹åƒã®é®®æ˜ã•ã¨è¦–è¦šè¨˜æ†¶ã®ç”ŸæˆåŠ›<br>
          <strong>å¾Œé ­è‘‰ï¼ˆå—å®¹ï¼‰ï¼š</strong>è¦–è¦šåˆºæ¿€ã®å—å®¹ã¨å‡¦ç†
        </div>

        <div class="section-subtitle">ğŸ§ª åŠ¹ç‡æ¯”ã¨ã¯ï¼Ÿ</div>
        <div class="brain-explanation">
          <strong>åŠ¹ç‡æ¯”</strong>ã¯ã€å‡è¦–æ™‚é–“ã«å¯¾ã™ã‚‹æ®‹åƒæ™‚é–“ã®æ¯”ç‡ã§ã™ã€‚<br>
          é«˜ã„ã»ã©ã€å°‘ãªã„åˆºæ¿€ã§é•·ã„æ®‹åƒã‚’ç”Ÿæˆã§ãã‚‹ã€Œè„³ã®å†…éƒ¨ç”Ÿæˆèƒ½åŠ›ã€ãŒå„ªã‚Œã¦ã„ã¾ã™ã€‚<br>
          <strong>ä¾‹ï¼š</strong>5ç§’å‡è¦–ã§30ç§’æ®‹åƒ â†’ åŠ¹ç‡æ¯” 6.0å€
        </div>

        <div class="section-subtitle">ğŸ’¡ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®ç›®æ¨™</div>
        <div class="brain-explanation">
          <strong>åˆå¿ƒè€…ï¼š</strong>ã¾ãšã¯30ç§’å‡è¦–ã§30ç§’æ®‹åƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³Eï¼‰ã‚’ç›®æŒ‡ã™<br>
          <strong>ä¸­ç´šè€…ï¼š</strong>10ï½15ç§’å‡è¦–ã§30ç§’æ®‹åƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³Bãƒ»Cï¼‰ã‚’ç›®æŒ‡ã™<br>
          <strong>ä¸Šç´šè€…ï¼š</strong>5ç§’å‡è¦–ã§30ç§’æ®‹åƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³Aï¼‰ã‚„ã€30ç§’å‡è¦–ã§60ç§’æ®‹åƒï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³Fï¼‰ã«æŒ‘æˆ¦
        </div>
      </div>

      <!-- ========== æ¨å¥¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒ³ ========== -->
      <div class="card">
        <h2>ğŸ¯ æ¨å¥¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ©ãƒ³</h2>
        <div class="explanation-grid">
          <div class="explanation-box">
            <h4>1é€±ç›®ï¼šåŸºç¤å›ºã‚</h4>
            <p><strong>ç›®æ¨™ï¼š5ï½30ç§’å‡è¦–ã§30ç§’æ®‹åƒ</strong></p>
            <p>æ¯æ—¥1ï½2ã‚»ãƒƒãƒˆã€å‡è¦–æ™‚é–“ã¯çŸ­ã‚ã§OKã€‚</p>
            <p>æ®‹åƒãŒè¦‹ãˆã‚‹ã“ã¨ã«æ…£ã‚Œã‚‹æ®µéšã§ã™ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>2é€±ç›®ï¼šåŠ¹ç‡åŒ–</h4>
            <p><strong>ç›®æ¨™ï¼š10ï½30ç§’å‡è¦–ã§30ç§’æ®‹åƒ</strong></p>
            <p>å‡è¦–æ™‚é–“ã‚’å¾ã€…ã«çŸ­ãã—ã¦ã€æ®‹åƒæ™‚é–“ã‚’ç¶­æŒã€‚</p>
            <p>è„³ã®å†…éƒ¨ç”ŸæˆåŠ›ã‚’é«˜ã‚ã‚‹æ®µéšã§ã™ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>3é€±ç›®ä»¥é™ï¼šæŒ‘æˆ¦</h4>
            <p><strong>ç›®æ¨™ï¼š5ï½30ç§’å‡è¦–ã§30ç§’æ®‹åƒ</strong></p>
            <p>åŠ¹ç‡æ¯”6.0å€ä»¥ä¸Šã‚’ç›®æŒ‡ã™ã€‚</p>
            <p>ã¾ãŸã¯ã€30ç§’å‡è¦–ã§60ç§’æ®‹åƒã«æŒ‘æˆ¦ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>ç¶™ç¶šã®ã‚³ãƒ„</h4>
            <p>ç„¡ç†ã›ãšã€æ¯æ—¥ç¶šã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚</p>
            <p>æ®‹åƒãŒè¦‹ãˆã«ãã„æ—¥ã‚‚ã‚ã‚‹ã®ã§ã€ç„¦ã‚‰ãšã«ã€‚</p>
            <p>é•·æœŸçš„ã«ã¯ã€è„³ã®å¯å¡‘æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚</p>
          </div>
        </div>
      </div>

      <!-- ========== ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ ========== -->
      <div class="card">
        <h2>ğŸ’Š ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
        <div class="explanation-grid">
          <div class="explanation-box">
            <h4>ãƒ‘ã‚¿ãƒ¼ãƒ³Aï½Cã®æ–¹ã¸</h4>
            <p>çŸ­æ™‚é–“ã®å‡è¦–ã§é•·ã„æ®‹åƒã‚’ç”Ÿæˆã§ãã‚‹ã€Œé«˜åŠ¹ç‡å‹ã€ã§ã™ã€‚</p>
            <p>è„³ã®å†…éƒ¨ç”ŸæˆåŠ›ãŒå„ªã‚Œã¦ã„ã‚‹ã®ã§ã€30ç§’å‡è¦–ã§60ç§’æ®‹åƒã«æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>ãƒ‘ã‚¿ãƒ¼ãƒ³Dï½Eã®æ–¹ã¸</h4>
            <p>æ¨™æº–çš„ãªè„³æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚</p>
            <p>ã¾ãšã¯10ï½15ç§’å‡è¦–ã§30ç§’æ®‹åƒã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚</p>
            <p>å¾ã€…ã«å‡è¦–æ™‚é–“ã‚’çŸ­ãã—ã¦ã€åŠ¹ç‡æ¯”ã‚’é«˜ã‚ã¦ã„ãã¾ã™ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>ãƒ‘ã‚¿ãƒ¼ãƒ³Fã®æ–¹ã¸</h4>
            <p>é•·æ™‚é–“ã®å‡è¦–ã¨æ®‹åƒã‚’ç¶­æŒã§ãã‚‹ã€ŒæŒä¹…å‹ã€ã§ã™ã€‚</p>
            <p>å…¨è„³çš„ãªæŒä¹…åŠ›ãŒé«˜ã„ã®ã§ã€ã•ã‚‰ã«é•·æ™‚é–“ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã«æŒ‘æˆ¦ã§ãã¾ã™ã€‚</p>
            <p>ã¾ãŸã¯ã€å‡è¦–æ™‚é–“ã‚’çŸ­ãã—ã¦åŠ¹ç‡æ¯”ã‚’é«˜ã‚ã‚‹æ–¹å‘ã‚‚æœ‰åŠ¹ã§ã™ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>æ®‹åƒãŒè¦‹ãˆãªã„æ–¹ã¸</h4>
            <p>ã¾ãšã¯30ç§’å‡è¦–ã‹ã‚‰å§‹ã‚ã¦ãã ã•ã„ã€‚</p>
            <p>ç›®ã‚’é–‰ã˜ã¦æš—ã„å ´æ‰€ã§ç¢ºèªã™ã‚‹ã¨ã€æ®‹åƒãŒè¦‹ãˆã‚„ã™ããªã‚Šã¾ã™ã€‚</p>
            <p>å€‹äººå·®ãŒå¤§ãã„ã®ã§ã€ç„¦ã‚‰ãšç¶šã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚</p>
          </div>
        </div>
      </div>

      <!-- ========== æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— (NEW) ========== -->
      <div class="card">
        <h2>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h2>
        <div class="explanation-grid">
          <div class="explanation-box">
            <h4>ç›®æ¨™1ï¼šå‡è¦–æ™‚é–“ã®çŸ­ç¸®</h4>
            <p>ã€Œ30ç§’å‡è¦– â†’ 30ç§’æ®‹åƒã€ã‹ã‚‰ã€Œ10ç§’å‡è¦– â†’ 30ç§’æ®‹åƒã€ã¸ã®æŒ‘æˆ¦ã€ãã—ã¦ã€Œ5ç§’å‡è¦– â†’ 30ç§’æ®‹åƒã€ã¸ã®æŒ‘æˆ¦</p>
            <p>ã“ã‚Œã¯å´é ­è‘‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ç”ŸæˆåŠ›ãŒæ˜Ÿ5ã¤ã«ãªã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</p>
          </div>
          <div class="explanation-box">
            <h4>ç›®æ¨™2ï¼šå¿œç”¨ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h4>
            <p>æ®‹åƒã®è‰²ã‚’æ„å¿—ã§å¤‰ãˆã‚‹ï¼ˆèµ¤ â†’ ç·‘ãªã©ï¼‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</p>
            <p>å½¢ã‚’å‹•ã‹ã™ã€ã‚µã‚¤ã‚ºã‚’å¤‰ãˆã‚‹ãªã©ã€ã‚¤ãƒ¡ãƒ¼ã‚¸æ“ä½œèƒ½åŠ›ã‚’é«˜ã‚ã‚‹</p>
          </div>
          <div class="explanation-box">
            <h4>æ¸¬å®šåŸºæº–ã®çµ±ä¸€</h4>
            <p>ã€Œè¼ªéƒ­ãŒã¯ã£ãã‚Šè¦‹ãˆã¦ã„ã‚‹çŠ¶æ…‹ã€ã§çµ‚äº†ã‚’åˆ¤å®š</p>
            <p>æ¯å›åŒã˜åŸºæº–ã§æ¸¬å®šã™ã‚‹ã“ã¨ã§ã€é€²æ­©ãŒæ­£ç¢ºã«è¿½è·¡ã§ãã¾ã™</p>
          </div>
          <div class="explanation-box">
            <h4>ç¶™ç¶šæ€§</h4>
            <p>é€±3ï½5å›ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç¶™ç¶šã§ã€ã•ã‚‰ãªã‚‹è„³ã®åŠ¹ç‡åŒ–ãŒæœŸå¾…ã§ãã¾ã™</p>
            <p>ã‚ãªãŸã®è„³ã¯æ—¢ã«å„ªç§€ãªæ®µéšã«ã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ï¼</p>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ“š å‚è€ƒæ–‡çŒ®</h2>
        <p class="description">
          ã“ã®ã‚¢ãƒ—ãƒªã¯ã€2025å¹´ã®æœ€æ–°ç ”ç©¶ã‚’ã‚‚ã¨ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
        </p>
        <div class="brain-explanation">
          <strong>ä¸»ãªå‚è€ƒæ–‡çŒ®ï¼š</strong>
          <ul style="margin: 0.5rem 0 0; padding-left: 1.5rem;">
            <li>Kronemer et al. (2025) - 7T MRIã«ã‚ˆã‚‹è„³æ´»å‹•ã¨fMRIä¿¡å·ã®é–¢ä¿‚</li>
            <li>Spagna et al. (2021) - è¦–è¦šæ®‹åƒã¨æ³¨æ„ã®ç¥çµŒãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼ˆ46ãƒšãƒ¼ã‚¸ã®æ–‡çŒ®ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰</li>
            <li>Tsuchiya &amp; Koch (2005) - é€£ç¶šãƒ•ãƒ©ãƒƒã‚·ãƒ¥æŠ‘åˆ¶ã¨è¦–è¦šæ„è­˜</li>
            <li>Brascamp et al. (2010) - è² ã®æ®‹åƒã®è¦–è¦šç‰¹æ€§ã¨ç¥çµŒåŸºç›¤</li>
          </ul>
        </div>
        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(255, 152, 0, 0.1); border-radius: 8px; border-left: 3px solid var(--accent);">
          <p style="margin: 0; font-size: 0.85rem; line-height: 1.6;">
            <strong>âš  å…è²¬äº‹é …ï¼š</strong>
            ã“ã®ã‚¢ãƒ—ãƒªã¯ç ”ç©¶è«–æ–‡ã‚’å‚è€ƒã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ãŒã€åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è„³æ´»å‹•ã®æ¨å®šå€¤ã¯å‚è€ƒæƒ…å ±ã§ã‚ã‚Šã€è¨ºæ–­ãƒ»æ²»ç™‚ã«ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚
          </p>
        </div>
      </div>
    </section>

    <!-- ========== SETTINGS VIEW ========== -->
    <section id="settings" class="view hidden">
      <h1 class="title">âš™ è¨­å®š</h1>
      <div class="card">
        <h2>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
        <div class="row">
          <button id="backupBtn" onclick="handleBackupClick()">ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
        </div>
        <div class="row" style="margin-top:0.75rem;">
          <div class="muted" id="driveStatus" style="margin-top:0.5rem;"></div>
          <button id="gAuthBtn" class="secondary">ğŸ” Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
          <button id="pickDriveFileBtn" class="secondary" disabled>ğŸ“‚ Driveã®JSONã‚’é¸æŠ</button>
          <button id="driveLoadBtn" class="secondary" disabled>â˜ Driveã‹ã‚‰èª­è¾¼</button>
          <button id="driveSaveBtn" disabled>ğŸ’¾ Driveã¸ä¿å­˜</button>
          <button id="driveSaveAsBtn" class="secondary" disabled>ğŸ’¾ Driveã¸åˆ¥åä¿å­˜</button>
        </div>
        <button id="importBtn" onclick="document.getElementById('importFile').click()">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <input id="importFile" type="file" accept="application/json" style="display:none;">
        <button id="deleteBtn" class="danger" onclick="handleDeleteClick()">ğŸ—‘ å…¨å‰Šé™¤</button>
      </div>

      <p class="muted" style="margin-top:0.75rem; line-height:1.7;">
        <strong>ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ï¼š</strong><br>
        ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ï¼ˆLocalStorageï¼‰ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚Google Driveã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã€ä»–ã®ç«¯æœ«ã§ã‚‚åŒæœŸã§ãã¾ã™ã€‚
      </p>

      <div class="card" style="border: 2px solid var(--accent); background: rgba(255,152,0,0.05);">
        <h3>Driveãƒœã‚¿ãƒ³ã®ä½¿ã„æ–¹ï¼ˆä½œè€…ã®ã¿ä½¿ç”¨å¯èƒ½ï¼‰</h3>
        <p class="muted">
          â€»ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥/ã‚µã‚¤ãƒˆãƒ‡ãƒ¼ã‚¿å‰Šé™¤ç­‰ã§æ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€å®šæœŸçš„ã«ã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚<br>
          â€»Googleãƒ­ã‚°ã‚¤ãƒ³/Google Driveé–¢é€£ã®æ©Ÿèƒ½ã¯ä½œæˆè€…å‘ã‘ã§ã™ã€‚é€šå¸¸ã¯ã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã€Œãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã€Œã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã€ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
        </p>
      </div>

      <details class="science-details" style="margin-top:0.75rem;">
        <summary>ğŸ“– Google Driveã®ä½¿ã„æ–¹</summary>
        <div class="science-details-content">
          <pre>ã€Google Driveé€£æºã®æ‰‹é †ã€‘
1. ã€ŒGoogleã§ãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. ã€ŒDriveã®JSONã‚’é¸æŠã€ã§æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠï¼ˆåˆå›ã¯ä¸è¦ï¼‰
4. ã€ŒDriveã¸ä¿å­˜ã€ã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ã€æ³¨æ„ã€‘
- Driveé€£æºæ™‚ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«IDãŒLocalStorageã«ä¿å­˜ã•ã‚Œã¾ã™
- åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚„ãƒ‡ãƒã‚¤ã‚¹ã§ã¯ã€å†åº¦ã€ŒDriveã®JSONã‚’é¸æŠã€ãŒå¿…è¦ã§ã™
- ã€ŒDriveã‹ã‚‰èª­è¾¼ã€ã¯æ—¢å­˜ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ã¾ã™
- ã€ŒDriveã¸åˆ¥åä¿å­˜ã€ã¯æ–°ã—ã„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™</pre>
        </div>
      </details>

      <div class="card">
        <h2>â„¹ï¸ ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</h2>
        <div class="muted" style="line-height: 1.8;">
          <p style="margin: 0 0 0.75rem 0;">
            <strong>Orange Card v8.1</strong>
          </p>
          <p style="margin: 0 0 1rem 0;">
            è„³ã®è¦–è¦šæ©Ÿèƒ½ã‚’ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã™ã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚
          </p>

          <p style="margin: 0.75rem 0 0.25rem 0;">
            <strong>ğŸ’¡ ã“ã®ã‚¢ãƒ—ãƒªã®ç‰¹å¾´</strong>
          </p>
          <ul style="margin: 0 0 1rem 0; padding-left: 1.5rem;">
            <li>æœ€æ–°ã®fMRIç ”ç©¶ã‚’ã‚‚ã¨ã«ã—ãŸè„³æ´»å‹•æ¨å®š</li>
            <li>æ®‹åƒãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§è¦–è¦šè¨˜æ†¶ã‚’å¼·åŒ–</li>
            <li>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§é€²æ—ã‚’å¯è¦–åŒ–</li>
            <li>ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ</li>
          </ul>

          <p style="margin: 0.75rem 0 0.25rem 0;">
            <strong>âš  æ³¨æ„äº‹é …</strong>
          </p>
          <ul style="margin: 0 0 1rem 0; padding-left: 1.5rem;">
            <li>åŒ»ç™‚æ©Ÿå™¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“</li>
            <li>è„³æ´»å‹•ã®æ¨å®šå€¤ã¯å‚è€ƒæƒ…å ±ã§ã™</li>
            <li>ä¸å¿«æ„ŸãŒã‚ã‚‹å ´åˆã¯ç›´ã¡ã«ä¸­æ­¢ã—ã¦ãã ã•ã„</li>
            <li>3æ­³æœªæº€ã®ãŠå­æ§˜ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„</li>
          </ul>

          <p style="margin: 0.75rem 0 0.25rem 0;">
            <strong>ğŸ“§ ãŠå•ã„åˆã‚ã›</strong>
          </p>
          <ul style="margin: 0; padding-left: 1.5rem;">
            <li>ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½è¦æœ›ã¯ã€GitHubã®Issuesã¸ãŠé¡˜ã„ã—ã¾ã™</li>
            <li>ã“ã®ã‚¢ãƒ—ãƒªã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“</li>
            <li>fMRIç ”ç©¶ã®è©³ç´°ã¯ã€å‚è€ƒæ–‡çŒ®ã‚’ã”è¦§ãã ã•ã„</li>
            <li>å€‹äººæƒ…å ±ã¯ä¸€åˆ‡åé›†ã—ã¦ã„ã¾ã›ã‚“</li>
            <li>JSONãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨Google Driveé€£æºã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <!-- Google APIs -->
  <script defer src="https://apis.google.com/js/api.js"></script>
  <script defer src="https://accounts.google.com/gsi/client"></script>

  <script>
    "use strict";

    // ========== DASHBOARD ==========
    function refreshDashboard() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const todaySessions = sessions.filter(s => {
        const d = new Date(s.timestamp);
        d.setHours(0, 0, 0, 0);
        return d.getTime() === today.getTime();
      });

      const todayCountEl = document.getElementById("todayCount");
      const totalCountEl = document.getElementById("totalCount");
      if (todayCountEl) todayCountEl.textContent = todaySessions.length;
      if (totalCountEl) totalCountEl.textContent = sessions.length;

      const avgEl = document.getElementById("avgAfterImage");
      const stabilityEl = document.getElementById("stability");
      const badgeEl = document.getElementById("avgBadge");

      if (!sessions.length) {
        if (avgEl) avgEl.textContent = "-";
        if (stabilityEl) stabilityEl.textContent = "-";
        if (badgeEl) badgeEl.textContent = "";
        return;
      }

      const afterValues = sessions.map(s => Number(s.afterSec) || 0);
      const avgAfter = afterValues.reduce((sum, v) => sum + v, 0) / afterValues.length;
      const variance = afterValues.reduce((sum, v) => sum + Math.pow(v - avgAfter, 2), 0) / afterValues.length;
      const stdDev = Math.sqrt(variance);

      if (avgEl) avgEl.textContent = avgAfter.toFixed(2);
      if (stabilityEl) stabilityEl.textContent = stdDev.toFixed(2);

      if (badgeEl) {
        if (avgAfter >= 8) {
          badgeEl.textContent = "å„ªç§€";
          badgeEl.className = "score-badge excellent";
        } else if (avgAfter >= 5) {
          badgeEl.textContent = "è‰¯å¥½";
          badgeEl.className = "score-badge good";
        } else {
          badgeEl.textContent = "æ”¹å–„ä¸­";
          badgeEl.className = "score-badge improving";
        }
      }

      const recentTable = document.getElementById("recentTable");
      if (recentTable) {
        recentTable.innerHTML = "";
        const recent = sessions.slice(-10).reverse();
        recent.forEach(s => {
          const row = document.createElement("tr");
          row.style.borderBottom = "1px solid var(--line)";
          const date = new Date(s.timestamp);
          const sharpnessText = s.sharpness === 3 ? "3 - é®®æ˜" : s.sharpness === 2 ? "2 - ã¼ã‚“ã‚„ã‚Š" : "1 - è¦‹ãˆãªã„";
          row.innerHTML = `
            <td style="padding: 0.5rem">${date.toLocaleTimeString("ja-JP")}</td>
            <td style="padding: 0.5rem">${s.stareSec}ç§’</td>
            <td style="padding: 0.5rem">${Number(s.afterSec).toFixed(2)}ç§’</td>
            <td style="padding: 0.5rem">${sharpnessText}</td>
          `;
          recentTable.appendChild(row);
        });
      }

      updateCharts();
    }

    // ========== GOOGLE DRIVE ==========
    const CLIENTID = "312868081144-1c6gjkal8rgllhi8iqgblbgjarc058jc.apps.googleusercontent.com";
    const APIKEY = "AIzaSyDhw-1p83aMURAZqPGrrmTe8EJU68Dj82I";
    const APPID = "312868081144";
    const DRIVESCOPES = "https://www.googleapis.com/auth/drive.file";
    const DRIVEDISCOVERY = "https://www.googleapis.com/discovery/v1/apis/drive/v3/rest";

    let tokenClient = null;
    let accessToken;
    let pickedFileId;
    let pickerReady = false;

    function setDriveStatus(msg) {
      const el = document.getElementById("driveStatus");
      if (el) el.textContent = msg;
    }

    function updateDriveButtons() {
      const pickBtn = document.getElementById("pickDriveFileBtn");
      const loadBtn = document.getElementById("driveLoadBtn");
      const saveBtn = document.getElementById("driveSaveBtn");
      const saveAsBtn = document.getElementById("driveSaveAsBtn");

      const hasToken = !!accessToken;
      const hasFile = !!pickedFileId;

      if (pickBtn) pickBtn.disabled = !hasToken;
      if (loadBtn) loadBtn.disabled = !(hasToken && hasFile);
      if (saveBtn) saveBtn.disabled = !(hasToken && hasFile);
      if (saveAsBtn) saveAsBtn.disabled = !(hasToken && hasFile);
    }

    function loadDriveFileId() {
      pickedFileId = localStorage.getItem("driveFileId");
    }

    function wireDriveUi() {
      const gAuthBtn = document.getElementById("gAuthBtn");
      const pickBtn = document.getElementById("pickDriveFileBtn");
      const loadBtn = document.getElementById("driveLoadBtn");
      const saveBtn = document.getElementById("driveSaveBtn");
      const saveAsBtn = document.getElementById("driveSaveAsBtn");

      if (gAuthBtn) gAuthBtn.onclick = () => requestAccessToken(true);
      if (pickBtn) pickBtn.onclick = openPicker;
      if (loadBtn) loadBtn.onclick = driveLoad;
      if (saveBtn) saveBtn.onclick = driveSave;
      if (saveAsBtn) saveAsBtn.onclick = driveSaveAsNewSameFolder;

      setDriveStatus(pickedFileId ? `Driveãƒ•ã‚¡ã‚¤ãƒ«ID: ${pickedFileId}` : "Driveãƒ•ã‚¡ã‚¤ãƒ«ID: æœªé¸æŠ");
      updateDriveButtons();
    }

    function requestAccessToken(interactive) {
      if (!tokenClient) {
        setDriveStatus("OAuthã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæœªåˆæœŸåŒ–ã€‚initGoogleDriveClient()ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      tokenClient.requestAccessToken({ prompt: interactive ? "consent" : "" });
    }

    async function initGoogleDriveClient() {
      if (!window.gapi) throw new Error("gapiæœªãƒ­ãƒ¼ãƒ‰ã€‚api.jsã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
      if (!window.google?.accounts?.oauth2) throw new Error("GISæœªãƒ­ãƒ¼ãƒ‰ã€‚gsiclientã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");

      await new Promise((resolve, reject) => {
        gapi.load("client:picker", async () => {
          try {
            await gapi.client.init({
              apiKey: APIKEY,
              discoveryDocs: [DRIVEDISCOVERY],
            });
            pickerReady = true;
            resolve();
          } catch (e) {
            reject(e);
          }
        });
      });

      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENTID,
        scope: DRIVESCOPES,
        callback: (resp) => {
          if (resp?.error) {
            setDriveStatus(`OAuthå¤±æ•—: ${resp.error}`);
            return;
          }
          accessToken = resp.access_token;
          gapi.client.setToken({ access_token: accessToken });
          setDriveStatus("OAuthãƒˆãƒ¼ã‚¯ãƒ³å–å¾—æˆåŠŸã€‚Driveã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã§ã™ã€‚");
          updateDriveButtons();
        },
      });

      setDriveStatus("DriveClåˆæœŸåŒ–å®Œäº†ã€‚OKãƒœã‚¿ãƒ³ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
      updateDriveButtons();
    }

    function openPicker() {
      if (!pickerReady) return;
      if (!accessToken) {
        requestAccessToken(true);
        return;
      }

      const view = new google.picker.View(google.picker.ViewId.DOCS);
      view.setMimeTypes("application/json");

      const picker = new google.picker.PickerBuilder()
        .addView(view)
        .setOAuthToken(accessToken)
        .setDeveloperKey(APIKEY)
        .setAppId(APPID)
        .setCallback(pickerCallback)
        .build();
      picker.setVisible(true);
    }

    function pickerCallback(data) {
      if (data.action === google.picker.Action.PICKED) {
        const doc = data.docs?.[0];
        pickedFileId = doc?.id;
        if (pickedFileId) {
          localStorage.setItem("driveFileId", pickedFileId);
          setDriveStatus(`é¸æŠ: ${doc.name} (ID: ${pickedFileId})`);
        } else {
          setDriveStatus("ãƒ•ã‚¡ã‚¤ãƒ«IDå–å¾—å¤±æ•—");
        }
        updateDriveButtons();
      }
      if (data.action === google.picker.Action.CANCEL) {
        setDriveStatus("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");
      }
    }

    async function driveLoad() {
      if (!accessToken) {
        setDriveStatus("ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      if (!pickedFileId) {
        setDriveStatus("Driveãƒ•ã‚¡ã‚¤ãƒ«JSONã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }
      try {
        const resp = await gapi.client.drive.files.get({
          fileId: pickedFileId,
          alt: "media",
          supportsAllDrives: true,
        });
        const raw = resp.body;
        const data = JSON.parse(raw);
        const loadedSessions = Array.isArray(data) ? data : (data.sessions || null);
        if (!Array.isArray(loadedSessions)) {
          setDriveStatus("JSONå½¢å¼ã‚¨ãƒ©ãƒ¼: sessionsé…åˆ—ãŒã‚ã‚Šã¾ã›ã‚“");
          return;
        }
        sessions = loadedSessions;
        localStorage.setItem("orangeCardSessions", JSON.stringify(sessions));
        refreshDashboard();
        setDriveStatus(`Driveã‹ã‚‰èª­è¾¼å®Œäº†: ${sessions.length}ä»¶`);
      } catch (e) {
        console.error("Drive load error:", e);
        setDriveStatus(`èª­è¾¼å¤±æ•—: ${e.message || e}`);
      }
    }

    async function driveSave() {
      if (!accessToken) {
        setDriveStatus("Driveãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      if (!pickedFileId) {
        setDriveStatus("Drive JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }
      try {
        const payloadObj = {
          appVersion: "v8.1",
          exportDate: new Date().toISOString(),
          totalSessions: sessions.length,
          sessions,
        };
        const payload = JSON.stringify(payloadObj, null, 2);

        const url = `https://www.googleapis.com/upload/drive/v3/files/${encodeURIComponent(pickedFileId)}?uploadType=media&supportsAllDrives=true`;
        const r = await fetch(url, {
          method: "PATCH",
          headers: {
            "Authorization": `Bearer ${accessToken}`,
            "Content-Type": "application/json; charset=utf-8",
          },
          body: payload,
        });
        if (!r.ok) {
          const t = await r.text().catch(() => "");
          throw new Error(`HTTP ${r.status}: ${t}`);
        }
        setDriveStatus(`Driveã¸ä¿å­˜æˆåŠŸï¼ˆä¸Šæ›¸ãï¼‰: ${sessions.length}ä»¶`);
      } catch (e) {
        console.error("Drive save error:", e);
        setDriveStatus(e?.message || String(e));
      }
    }

    async function driveSaveAsNewSameFolder() {
      if (!accessToken) {
        setDriveStatus("Driveãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      if (!pickedFileId) {
        setDriveStatus("Drive JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }
      try {
        const meta = await gapi.client.drive.files.get({
          fileId: pickedFileId,
          fields: "parents,name",
          supportsAllDrives: true,
        });
        const parentId = meta.result?.parents?.[0] || null;

        const payloadObj = {
          appVersion: "v8.1",
          exportDate: new Date().toISOString(),
          totalSessions: sessions.length,
          sessions,
        };
        const payload = JSON.stringify(payloadObj, null, 2);

        const name = `orange-card-backup-${new Date().toISOString().replace(/\./g, "-")}.json`;
        const metadata = {
          name,
          mimeType: "application/json",
          ...(parentId ? { parents: [parentId] } : {}),
        };

        const form = new FormData();
        form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
        form.append("file", new Blob([payload], { type: "application/json" }));

        const res = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&supportsAllDrives=true", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${accessToken}`,
          },
          body: form,
        });
        if (!res.ok) {
          const t = await res.text().catch(() => "");
          throw new Error(`HTTP ${res.status}: ${t}`);
        }
        setDriveStatus(`Driveã¸åˆ¥åä¿å­˜æˆåŠŸ: ${name}`);
      } catch (e) {
        console.error("Drive saveAs error:", e);
        setDriveStatus(e?.message || String(e));
      }
    }

    // ========== GLOBAL STATE ==========
    let sessions = [];
    let stareTimer = null;
    let afterTimer = null;
    let afterStart = null;
    let selectedSharpness = 3;
    let isTraining = false;
    let currentSession = null;

    let afterImageChartInstance = null;
    let sharpnessChartInstance = null;
    let countdownTimer = null;

    window.addEventListener("load", function() {
      initApp();
    });

    function initApp() {
      initTabs();
      initSharpnessListeners();
      loadSessions();
      refreshDashboard();
      loadDriveFileId();
      wireDriveUi();
      initGoogleDriveClient().catch(e => {
        setDriveStatus(e.message);
      });
    }

    // ========== TABS ==========
    function initTabs() {
      const tabs = document.querySelectorAll("[data-tab]");
      tabs.forEach(tab => {
        tab.onclick = function(e) {
          e.preventDefault();
          const tabName = this.dataset.tab;

          document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
          this.classList.add("active");

          document.querySelectorAll(".view").forEach(v => v.classList.add("hidden"));
          document.getElementById(tabName).classList.remove("hidden");

          if (tabName === "dashboard") {
            refreshDashboard();
          }
        };
      });
    }

    // ========== SHARPNESS ==========
    function initSharpnessListeners() {
      const radios = document.querySelectorAll("input[name='sharpness']");
      radios.forEach(radio => {
        radio.onchange = function() {
          selectedSharpness = parseInt(this.value);
          document.querySelectorAll(".sharpness-option").forEach(opt => opt.classList.remove("selected"));
          this.parentElement.classList.add("selected");
        };
      });
    }

    // ========== START TRAINING ==========
    function handleStartClick() {
      if (isTraining) return;

      if (stareTimer !== null) clearTimeout(stareTimer);
      if (afterTimer !== null) clearInterval(afterTimer);
      if (countdownTimer !== null) clearInterval(countdownTimer);
      afterStart = null;
      isTraining = true;

      document.getElementById("startBtn").disabled = true;

      const stareSec = parseInt(document.getElementById("stareSec").value);

      const overlay = document.getElementById("fullscreenOverlay");
      overlay.classList.remove("hidden");
      overlay.classList.add("show");

      let remaining = stareSec;
      document.getElementById("fullscreenTimer").textContent = remaining;

      countdownTimer = setInterval(() => {
        remaining--;
        document.getElementById("fullscreenTimer").textContent = remaining;
        if (remaining <= 0) {
          clearInterval(countdownTimer);
          countdownTimer = null;
          startAfterImage();
        }
      }, 1000);
    }

    function closeFullscreen() {
      document.getElementById("fullscreenOverlay").classList.remove("show");
      document.getElementById("fullscreenOverlay").classList.add("hidden");
    }

    function closeOverlays() {
      document.getElementById("afterImageOverlay").classList.remove("show");
      document.getElementById("afterImageOverlay").classList.add("hidden");
      document.getElementById("sharpnessOverlay").classList.remove("show");
      document.getElementById("sharpnessOverlay").classList.add("hidden");
    }

    function startAfterImage() {
      const overlay = document.getElementById("fullscreenOverlay");
      overlay.classList.remove("show");
      overlay.classList.add("hidden");

      afterStart = Date.now();

      const afterOverlay = document.getElementById("afterImageOverlay");
      afterOverlay.classList.remove("hidden");
      afterOverlay.classList.add("show");

      if (afterTimer !== null) clearInterval(afterTimer);
      afterTimer = setInterval(() => {
        if (afterStart === null) return;
        const elapsed = (Date.now() - afterStart) / 1000;
        document.getElementById("afterSec").textContent = elapsed.toFixed(1);
      }, 100);

      const clickHandler = () => {
        endAfterImage();
        document.removeEventListener("click", clickHandler);
      };
      document.addEventListener("click", clickHandler);
    }

    function endAfterImage() {
      if (afterStart === null) return;

      if (afterTimer !== null) {
        clearInterval(afterTimer);
        afterTimer = null;
      }

      const afterSec = (Date.now() - afterStart) / 1000;
      afterStart = null;

      const overlay = document.getElementById("afterImageOverlay");
      overlay.classList.remove("show");
      overlay.classList.add("hidden");

      setTimeout(() => {
        showSharpnessSelection(parseInt(document.getElementById("stareSec").value), afterSec);
      }, 150);
    }

    function showSharpnessSelection(stareSec, afterSec) {
      const radios = document.querySelectorAll("input[name='sharpness']");
      radios.forEach(r => {
        if (r.value === "3") {
          r.checked = true;
          r.parentElement.classList.add("selected");
        } else {
          r.parentElement.classList.remove("selected");
        }
      });
      selectedSharpness = 3;

      currentSession = { stareSec, afterSec };

      const overlay = document.getElementById("sharpnessOverlay");
      overlay.classList.add("show");
      overlay.classList.remove("hidden");
    }

    function handleConfirmClick() {
      if (!currentSession) return;

      const session = currentSession;
      session.sharpness = selectedSharpness;
      session.timestamp = new Date().toISOString();

      sessions.push(session);

      try {
        const json = JSON.stringify(sessions);
        if (json.length > 5242880) {
          sessions = sessions.slice(-100);
          localStorage.setItem("orangeCardSessions", JSON.stringify(sessions));
        } else {
          localStorage.setItem("orangeCardSessions", json);
        }
      } catch (e) {
        console.error("v8.1 LocalStorage error:", e);
        alert("âš  ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚å®¹é‡è¶…éã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚");
      }

      document.getElementById("sharpnessOverlay").classList.remove("show");
      document.getElementById("sharpnessOverlay").classList.add("hidden");

      showResult(session);
      updateBrainVisualization(session);

      setTimeout(() => {
        isTraining = false;
        document.getElementById("startBtn").disabled = false;
        currentSession = null;
      }, 1000);
    }

    function handleRetryClick() {
      document.getElementById("sharpnessOverlay").classList.remove("show");
      document.getElementById("sharpnessOverlay").classList.add("hidden");
      isTraining = false;
      document.getElementById("startBtn").disabled = false;
      currentSession = null;
    }

    function showResult(session) {
      const sharpnessText = { 3: "éå¸¸ã«é®®æ˜", 2: "ã¼ã‚“ã‚„ã‚Š", 1: "ã»ã¼è¦‹ãˆãªã„" }[session.sharpness];
      const date = new Date(session.timestamp);

      const resultText = document.getElementById("resultText");
      resultText.innerHTML = `
        <strong>âœ… ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®Œäº†</strong><br>
        å‡è¦–æ™‚é–“: ${session.stareSec}ç§’<br>
        æ®‹åƒæ™‚é–“: ${session.afterSec.toFixed(2)}ç§’<br>
        é®®æ˜åº¦: ${sharpnessText}<br>
        è¨˜éŒ²æ™‚åˆ»: ${date.toLocaleTimeString("ja-JP")}
      `;

      const resultCard = document.getElementById("resultCard");
      resultCard.style.display = "block";
      document.getElementById("sessionHint").style.display = "none";

      setTimeout(() => {
        resultCard.style.display = "none";
      }, 5000);
    }

    // ========== BRAIN VISUALIZATION ==========
    const SHARPNESSMULTIPLIER = { 3: 1.2, 2: 1.0, 1: 0.7 };

    function updateBrainVisualization(session) {
      const stareSec = session.stareSec;
      const afterSec = session.afterSec;
      const sharpness = session.sharpness || 3;
      const sharpMult = SHARPNESSMULTIPLIER[sharpness] || 1.0;

      // --- 4ã¤ã®è„³é ˜åŸŸã‚¹ã‚³ã‚¢ ---
      const occipitalScore = Math.min(100, (stareSec / 20) * 100);
      const temporalScore = Math.min(100, (afterSec / 10) * sharpMult * 100);
      const frontalScore = Math.min(100, (stareSec / 30) * 100);
      const parietalScore = Math.min(100, ((stareSec + afterSec) / 15) * 100);

      const qualityScore = Math.round((occipitalScore + temporalScore + frontalScore + parietalScore) / 4);

      // --- SVGæ›´æ–° ---
      document.getElementById("pctOccipitalText").textContent = Math.round(occipitalScore) + "%";
      document.getElementById("pctTemporalText").textContent = Math.round(temporalScore) + "%";
      document.getElementById("pctFrontalText").textContent = Math.round(frontalScore) + "%";
      document.getElementById("pctParietalText").textContent = Math.round(parietalScore) + "%";

      // --- ã‚²ãƒ¼ã‚¸æ›´æ–° ---
      document.getElementById("gaugeVisual").style.width = Math.min(100, occipitalScore) + "%";
      document.getElementById("gaugeVisualText").textContent = Math.round(occipitalScore) + "%";

      const cognitiveLoad = (frontalScore + temporalScore) / 2;
      document.getElementById("gaugeCog").style.width = Math.min(100, cognitiveLoad) + "%";
      document.getElementById("gaugeCogText").textContent = Math.round(cognitiveLoad) + "%";

      // UIã®ã€ŒtemporalValã€IDã«è¡¨ç¤ºï¼ˆé ­é ‚è‘‰ã‚¹ã‚³ã‚¢ï¼‰
      document.getElementById("temporalVal").textContent = parietalScore.toFixed(0) + "%";

      // --- å“è³ªã‚¹ã‚³ã‚¢ ---
      document.getElementById("qualityScore").textContent = qualityScore + "%";

      const qualityLabel = document.getElementById("qualityLabel");
      if (qualityScore >= 75) {
        qualityLabel.textContent = "ğŸ‰ å„ªç§€ãªè„³æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³";
        qualityLabel.style.color = "#66bb6a";
      } else if (qualityScore >= 50) {
        qualityLabel.textContent = "ğŸ‘ è‰¯å¥½ãªè„³æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³";
        qualityLabel.style.color = "#ffc107";
      } else {
        qualityLabel.textContent = "ğŸ’ª ç¶™ç¶šã§æ”¹å–„ãŒæœŸå¾…ã§ãã¾ã™";
        qualityLabel.style.color = "#ef5350";
      }
    }

    // ========== CHARTS ==========
    function updateCharts() {
      if (sessions.length === 0) return;

      const last20 = sessions.slice(-20);
      const labels = last20.map((s, i) => i + 1);
      const afterImageData = last20.map(s => parseFloat(s.afterSec.toFixed(2)));

      const ctx1 = document.getElementById("afterImageChart").getContext("2d");
      if (afterImageChartInstance) {
        afterImageChartInstance.data.labels = labels;
        afterImageChartInstance.data.datasets[0].data = afterImageData;
        afterImageChartInstance.update();
      } else {
        afterImageChartInstance = new Chart(ctx1, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "æ®‹åƒæ™‚é–“ï¼ˆç§’ï¼‰",
              data: afterImageData,
              borderColor: "#ff9800",
              backgroundColor: "rgba(255, 152, 0, 0.1)",
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: "#ff9800",
              pointBorderColor: "#fff",
              pointBorderWidth: 2,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                labels: {
                  color: "#e7e7e7",
                  font: { size: 14 }
                }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { color: "#a8b0bf" },
                grid: { color: "#2a2f3a" },
              },
              x: {
                ticks: { color: "#a8b0bf" },
                grid: { color: "#2a2f3a" },
              }
            }
          }
        });
      }

      const sharpnessCount = { "éå¸¸ã«é®®æ˜": 0, "ã¼ã‚“ã‚„ã‚Š": 0, "ã»ã¼è¦‹ãˆãªã„": 0 };
      sessions.forEach(s => {
        const text = { 3: "éå¸¸ã«é®®æ˜", 2: "ã¼ã‚“ã‚„ã‚Š", 1: "ã»ã¼è¦‹ãˆãªã„" }[s.sharpness];
        if (sharpnessCount.hasOwnProperty(text)) {
          sharpnessCount[text]++;
        }
      });

      const ctx2 = document.getElementById("sharpnessChart").getContext("2d");
      if (sharpnessChartInstance) {
        sharpnessChartInstance.data.datasets[0].data = [sharpnessCount["éå¸¸ã«é®®æ˜"], sharpnessCount["ã¼ã‚“ã‚„ã‚Š"], sharpnessCount["ã»ã¼è¦‹ãˆãªã„"]];
        sharpnessChartInstance.update();
      } else {
        sharpnessChartInstance = new Chart(ctx2, {
          type: "doughnut",
          data: {
            labels: ["éå¸¸ã«é®®æ˜", "ã¼ã‚“ã‚„ã‚Š", "ã»ã¼è¦‹ãˆãªã„"],
            datasets: [{
              data: [sharpnessCount["éå¸¸ã«é®®æ˜"], sharpnessCount["ã¼ã‚“ã‚„ã‚Š"], sharpnessCount["ã»ã¼è¦‹ãˆãªã„"]],
              backgroundColor: ["#2e7d32", "#ffb300", "#e53935"],
              borderColor: "#171a21",
              borderWidth: 2,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                labels: {
                  color: "#e7e7e7",
                  font: { size: 12 }
                }
              }
            }
          }
        });
      }
    }

    // ========== BACKUP / IMPORT / DELETE ==========
    function handleBackupClick() {
      if (sessions.length === 0) {
        alert("âš  ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }

      const data = {
        appVersion: "v8.1",
        exportDate: new Date().toISOString(),
        totalSessions: sessions.length,
        sessions: sessions
      };

      const timestamp = new Date().toISOString().slice(0, 10);
      const filename = `orange-card-backup-${timestamp}.json`;

      try {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        setTimeout(() => URL.revokeObjectURL(url), 100);
        alert(`âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${sessions.length}ä»¶`);
      } catch (e) {
        console.error("v8.1 Backup error:", e);
        alert("âš  ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      const importFile = document.getElementById("importFile");
      if (importFile) {
        importFile.onchange = function(e) {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = function(event) {
            try {
              const data = JSON.parse(event.target.result);
              if (data.sessions && Array.isArray(data.sessions)) {
                sessions = data.sessions;
                localStorage.setItem("orangeCardSessions", JSON.stringify(sessions));
                refreshDashboard();
                alert(`âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†: ${sessions.length}ä»¶`);
              } else {
                alert("âš  JSONå½¢å¼ã‚¨ãƒ©ãƒ¼: sessionsé…åˆ—ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
              }
            } catch (err) {
              console.error("v8.1 Import error:", err);
              alert("âš  JSONãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            }
          };
          reader.readAsText(file);
          this.value = "";
        };
      }
    });

    function handleDeleteClick() {
      if (confirm("âš  å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚")) {
        try {
          sessions = [];
          localStorage.removeItem("orangeCardSessions");
          refreshDashboard();
          alert("âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
        } catch (e) {
          console.error("v8.1 Delete error:", e);
          alert("âš  å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
      }
    }

    function loadSessions() {
      const stored = localStorage.getItem("orangeCardSessions");
      if (stored) {
        try {
          sessions = JSON.parse(stored);
        } catch (e) {
          console.warn("v8.1 Parse error:", e);
          sessions = [];
        }
      }
    }
  </script>
</body>
</html>